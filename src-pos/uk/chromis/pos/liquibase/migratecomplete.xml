<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

    <!-- 
        This is the base liquibase xml for a Foreign Keys and Indices used by migrate routine
    -->

    <property name="boolean.type" value="boolean" dbms="derby, postgresql, hypersql, hsqldb"/>
    <property name="boolean.type" value="bit" dbms="mysql"/>
    <property name="boolean.type" value="numeric(1)" dbms="oracle"/>

    <property name="blob.type" value="blob" dbms="oracle, derby, hypersql, hsqldb"/>
    <property name="blob.type" value="bytea" dbms="postgresql"/>
    <property name="blob.type" value="mediumblob" dbms="mysql"/>

    <changeSet author="Chromis POS" id="Create database indexes">
        <sql>
            CREATE UNIQUE INDEX CLOSEDCASH_INX_SEQ ON CLOSEDCASH (HOST, HOSTSEQUENCE);
            CREATE UNIQUE INDEX THIRDPARTIES_CIF_INX ON THIRDPARTIES (CIF);
            CREATE UNIQUE INDEX THIRDPARTIES_NAME_INX ON THIRDPARTIES (NAME);            
            CREATE UNIQUE INDEX PRODUCTS_INX_0 ON PRODUCTS (REFERENCE);
            CREATE UNIQUE INDEX PRODUCTS_INX_1 ON PRODUCTS (CODE);
            CREATE UNIQUE INDEX PKIT_INX_PROD ON PRODUCTS_KIT (PRODUCT,PRODUCT_KIT);
            CREATE UNIQUE INDEX RESOURCES_NAME_INX ON RESOURCES (NAME);
            CREATE UNIQUE INDEX ROLES_NAME_INX ON ROLES (NAME);
            CREATE UNIQUE INDEX STOCKCURRENT_INX ON STOCKCURRENT (LOCATION,PRODUCT,ATTRIBUTESETINSTANCE_ID);
            CREATE UNIQUE INDEX TAXCAT_NAME_INX ON TAXCATEGORIES (NAME);
            CREATE UNIQUE INDEX TAXCUSTCAT_NAME_INX ON TAXCUSTCATEGORIES (NAME);
            CREATE UNIQUE INDEX TAXES_NAME_INX ON TAXES (NAME);
            CREATE UNIQUE INDEX PLACES_NAME_INX ON PLACES (NAME);
            CREATE UNIQUE INDEX PEOPLE_NAME_INX ON PEOPLE (NAME);
            CREATE UNIQUE INDEX LOCATIONS_NAME_INX ON LOCATIONS (NAME);
            CREATE UNIQUE INDEX FLOORS_NAME_INX ON FLOORS (NAME);
            CREATE INDEX DBPERMISSIONS_CLASSNAME_INX ON DBPERMISSIONS (CLASSNAME);
            CREATE UNIQUE INDEX CUSTOMERS_SKEY_INX ON CUSTOMERS (SEARCHKEY);
            CREATE UNIQUE INDEX CATEGORIES_NAME_INX ON CATEGORIES (NAME);
            CREATE INDEX ATTSETINST_SET ON ATTRIBUTESETINSTANCE (ATTRIBUTESET_ID);
            CREATE INDEX ATTUSE_ATT ON ATTRIBUTEUSE (ATTRIBUTE_ID);
            CREATE UNIQUE INDEX ATTUSE_LINE ON ATTRIBUTEUSE (ATTRIBUTESET_ID, LINENO);
            CREATE INDEX ATTVAL_ATT ON ATTRIBUTEVALUE (ATTRIBUTE_ID);
            CREATE INDEX CLOSEDCASH_INX_1 ON CLOSEDCASH (DATESTART);
            CREATE INDEX PLACES_FK_1 ON PLACES (FLOOR);
            CREATE INDEX RECEIPTS_FK_MONEY ON RECEIPTS (MONEY);
            CREATE INDEX RECEIPTS_INX_1 ON RECEIPTS (DATENEW);
            CREATE UNIQUE INDEX RESERVATIONS_INX_1 ON RESERVATIONS (DATENEW);
            CREATE INDEX ATTINST_ATT ON ATTRIBUTEINSTANCE (ATTRIBUTE_ID);
            CREATE INDEX ATTINST_SET ON ATTRIBUTEINSTANCE (ATTRIBUTESETINSTANCE_ID);
            CREATE INDEX CUSTOMERS_CARD_INX ON CUSTOMERS (CARD);
            CREATE INDEX CUSTOMERS_NAME_INX ON CUSTOMERS (NAME);
            CREATE INDEX CUSTOMERS_TAXCAT ON CUSTOMERS (TAXCATEGORY);
            CREATE INDEX CUSTOMERS_TAXID_INX ON CUSTOMERS (TAXID);
            CREATE INDEX PAYMENTS_FK_RECEIPT ON PAYMENTS (RECEIPT);
            CREATE INDEX PAYMENTS_INX_1 ON PAYMENTS (PAYMENT);
            CREATE INDEX PEOPLE_CARD_INX ON PEOPLE (CARD);
            CREATE INDEX PEOPLE_FK_1 ON PEOPLE (ROLE);
            CREATE INDEX RES_CUST_FK_2 ON RESERVATION_CUSTOMERS (CUSTOMER);
            CREATE INDEX SHIFT_BREAKS_BREAKID ON SHIFT_BREAKS (BREAKID);
            CREATE INDEX SHIFT_BREAKS_SHIFTID ON SHIFT_BREAKS (SHIFTID);
            CREATE INDEX TICKETS_CUSTOMERS_FK ON TICKETS (CUSTOMER);
            CREATE INDEX TICKETS_FK_2 ON TICKETS (PERSON);
            CREATE INDEX TICKETS_TICKETID ON TICKETS (TICKETTYPE, TICKETID);
            CREATE INDEX lEAVES_PPLID ON LEAVES (PPLID);
            CREATE INDEX CATEGORIES_FK_1 ON CATEGORIES (PARENTID);
            CREATE INDEX FK_PRODUCT_PROMOTIONID ON PRODUCTS (PROMOTIONID);
            CREATE INDEX PRODUCTS_ATTRSET_FK ON PRODUCTS (ATTRIBUTESET_ID);
            CREATE INDEX PRODUCTS_FK_1 ON PRODUCTS (CATEGORY);
            CREATE INDEX PRODUCTS_PACKPRODUCT_FK ON PRODUCTS (PACKPRODUCT);
            CREATE INDEX PRODUCTS_TAXCAT_FK ON PRODUCTS (TAXCAT);
            CREATE UNIQUE INDEX PCOM_INX_PROD ON PRODUCTS_COM (PRODUCT, PRODUCT2);
            CREATE INDEX PRODUCTS_COM_FK_2 ON PRODUCTS_COM (PRODUCT2);
            CREATE INDEX PRODUCTS_KIT_FK_2 ON PRODUCTS_KIT (PRODUCT_KIT);
            CREATE INDEX STOCKCURRENT_ATTSETINST ON STOCKCURRENT (ATTRIBUTESETINSTANCE_ID);
            CREATE INDEX STOCKCURRENT_FK_1 ON STOCKCURRENT (PRODUCT);
            CREATE INDEX STOCKDIARY_ATTSETINST ON STOCKDIARY (ATTRIBUTESETINSTANCE_ID);
            CREATE INDEX STOCKDIARY_FK_1 ON STOCKDIARY (PRODUCT);
            CREATE INDEX STOCKDIARY_FK_2 ON STOCKDIARY (LOCATION);
            CREATE INDEX STOCKDIARY_INX_1 ON STOCKDIARY (DATENEW);
            CREATE INDEX STOCKLEVEL_LOCATION ON STOCKLEVEL (LOCATION);
            CREATE INDEX STOCKLEVEL_PRODUCT ON STOCKLEVEL (PRODUCT);
            CREATE INDEX TAXES_CAT_FK ON TAXES (CATEGORY);
            CREATE INDEX TAXES_CUSTCAT_FK ON TAXES (CUSTCATEGORY);
            CREATE INDEX TAXES_TAXES_FK ON TAXES (PARENTID);
            CREATE INDEX TAXLINES_RECEIPT ON TAXLINES (RECEIPT);
            CREATE INDEX TAXLINES_TAX ON TAXLINES (TAXID);
            CREATE INDEX TICKETLINES_ATTSETINST ON TICKETLINES (ATTRIBUTESETINSTANCE_ID);
            CREATE INDEX TICKETLINES_FK_2 ON TICKETLINES (PRODUCT);
            CREATE INDEX TICKETLINES_FK_3 ON TICKETLINES (TAXID);   
            CREATE UNIQUE INDEX PRODUCTS_NAME_INX ON PRODUCTS (NAME);
        </sql>
    </changeSet>
    
          
    <changeSet author="Chromis POS" id="Create foreignkeys">   
        <sql>
            ALTER TABLE attributeinstance ADD CONSTRAINT ATTINST_ATT FOREIGN KEY ( ATTRIBUTE_ID ) REFERENCES attribute( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE attributeinstance ADD CONSTRAINT ATTINST_SET FOREIGN KEY ( ATTRIBUTESETINSTANCE_ID ) REFERENCES attributesetinstance( ID ) ON DELETE CASCADE ON UPDATE NO ACTION;
            ALTER TABLE attributesetinstance ADD CONSTRAINT ATTSETINST_SET FOREIGN KEY ( ATTRIBUTESET_ID ) REFERENCES attributeset( ID ) ON DELETE CASCADE ON UPDATE NO ACTION;
            ALTER TABLE attributeuse ADD CONSTRAINT ATTUSE_ATT FOREIGN KEY ( ATTRIBUTE_ID ) REFERENCES attribute( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE attributeuse ADD CONSTRAINT ATTUSE_SET FOREIGN KEY ( ATTRIBUTESET_ID ) REFERENCES attributeset( ID ) ON DELETE CASCADE ON UPDATE NO ACTION;
            ALTER TABLE attributevalue ADD CONSTRAINT ATTVAL_ATT FOREIGN KEY ( ATTRIBUTE_ID ) REFERENCES attribute( ID ) ON DELETE CASCADE ON UPDATE NO ACTION;
            ALTER TABLE categories ADD CONSTRAINT CATEGORIES_FK_1 FOREIGN KEY ( PARENTID ) REFERENCES categories( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE customers ADD CONSTRAINT CUSTOMERS_TAXCAT FOREIGN KEY ( TAXCATEGORY ) REFERENCES taxcustcategories( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE leaves ADD CONSTRAINT lEAVES_PPLID FOREIGN KEY ( PPLID ) REFERENCES people( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE payments ADD CONSTRAINT PAYMENTS_FK_RECEIPT FOREIGN KEY ( RECEIPT ) REFERENCES receipts( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE people ADD CONSTRAINT PEOPLE_FK_1 FOREIGN KEY ( ROLE ) REFERENCES roles( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE places ADD CONSTRAINT PLACES_FK_1 FOREIGN KEY ( FLOOR ) REFERENCES floors( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE products ADD CONSTRAINT PRODUCTS_ATTRSET_FK FOREIGN KEY ( ATTRIBUTESET_ID ) REFERENCES attributeset( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE products ADD CONSTRAINT PRODUCTS_FK_1 FOREIGN KEY ( CATEGORY ) REFERENCES categories( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE products ADD CONSTRAINT PRODUCTS_PACKPRODUCT_FK FOREIGN KEY ( PACKPRODUCT ) REFERENCES products( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE products ADD CONSTRAINT FK_PRODUCT_PROMOTIONID FOREIGN KEY ( PROMOTIONID ) REFERENCES promotions( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE products ADD CONSTRAINT PRODUCTS_TAXCAT_FK FOREIGN KEY ( TAXCAT ) REFERENCES taxcategories( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE products_com ADD CONSTRAINT PRODUCTS_COM_FK_1 FOREIGN KEY ( PRODUCT ) REFERENCES products( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE products_com ADD CONSTRAINT PRODUCTS_COM_FK_2 FOREIGN KEY ( PRODUCT2 ) REFERENCES products( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE products_kit ADD CONSTRAINT PRODUCTS_KIT_FK_1 FOREIGN KEY ( PRODUCT ) REFERENCES products( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE products_kit ADD CONSTRAINT PRODUCTS_KIT_FK_2 FOREIGN KEY ( PRODUCT_KIT ) REFERENCES products( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE receipts ADD CONSTRAINT RECEIPTS_FK_MONEY FOREIGN KEY ( MONEY ) REFERENCES closedcash( MONEY ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE reservation_customers ADD CONSTRAINT RES_CUST_FK_2 FOREIGN KEY ( CUSTOMER ) REFERENCES customers( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE reservation_customers ADD CONSTRAINT RES_CUST_FK_1 FOREIGN KEY ( ID ) REFERENCES reservations( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE shift_breaks ADD CONSTRAINT SHIFT_BREAKS_BREAKID FOREIGN KEY ( BREAKID ) REFERENCES breaks( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE shift_breaks ADD CONSTRAINT SHIFT_BREAKS_SHIFTID FOREIGN KEY ( SHIFTID ) REFERENCES shifts( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE stockcurrent ADD CONSTRAINT STOCKCURRENT_ATTSETINST FOREIGN KEY ( ATTRIBUTESETINSTANCE_ID ) REFERENCES attributesetinstance( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE stockcurrent ADD CONSTRAINT STOCKCURRENT_FK_2 FOREIGN KEY ( LOCATION ) REFERENCES locations( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE stockcurrent ADD CONSTRAINT STOCKCURRENT_FK_1 FOREIGN KEY ( PRODUCT ) REFERENCES products( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE stockdiary ADD CONSTRAINT STOCKDIARY_ATTSETINST FOREIGN KEY ( ATTRIBUTESETINSTANCE_ID ) REFERENCES attributesetinstance( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE stockdiary ADD CONSTRAINT STOCKDIARY_FK_2 FOREIGN KEY ( LOCATION ) REFERENCES locations( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE stockdiary ADD CONSTRAINT STOCKDIARY_FK_1 FOREIGN KEY ( PRODUCT ) REFERENCES products( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE stocklevel ADD CONSTRAINT STOCKLEVEL_LOCATION FOREIGN KEY ( LOCATION ) REFERENCES locations( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE stocklevel ADD CONSTRAINT STOCKLEVEL_PRODUCT FOREIGN KEY ( PRODUCT ) REFERENCES products( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE taxes ADD CONSTRAINT TAXES_CAT_FK FOREIGN KEY ( CATEGORY ) REFERENCES taxcategories( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE taxes ADD CONSTRAINT TAXES_CUSTCAT_FK FOREIGN KEY ( CUSTCATEGORY ) REFERENCES taxcustcategories( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE taxes ADD CONSTRAINT TAXES_TAXES_FK FOREIGN KEY ( PARENTID ) REFERENCES taxes( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE taxlines ADD CONSTRAINT TAXLINES_RECEIPT FOREIGN KEY ( RECEIPT ) REFERENCES receipts( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE taxlines ADD CONSTRAINT TAXLINES_TAX FOREIGN KEY ( TAXID ) REFERENCES taxes( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE ticketlines ADD CONSTRAINT TICKETLINES_ATTSETINST FOREIGN KEY ( ATTRIBUTESETINSTANCE_ID ) REFERENCES attributesetinstance( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE ticketlines ADD CONSTRAINT TICKETLINES_FK_2 FOREIGN KEY ( PRODUCT ) REFERENCES products( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE ticketlines ADD CONSTRAINT TICKETLINES_FK_3 FOREIGN KEY ( TAXID ) REFERENCES taxes( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE ticketlines ADD CONSTRAINT TICKETLINES_FK_TICKET FOREIGN KEY ( TICKET ) REFERENCES tickets( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE tickets ADD CONSTRAINT TICKETS_CUSTOMERS_FK FOREIGN KEY ( CUSTOMER ) REFERENCES customers( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE tickets ADD CONSTRAINT TICKETS_FK_2 FOREIGN KEY ( PERSON ) REFERENCES people( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION;
            ALTER TABLE tickets ADD CONSTRAINT TICKETS_FK_ID FOREIGN KEY ( ID ) REFERENCES receipts( ID ) ON DELETE NO ACTION ON UPDATE NO ACTION; 
        </sql>
    </changeSet>


</databaseChangeLog>

